<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å•å…ƒæµ‹è¯•è¿è¡Œå™¨</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 6px;
            background-color: #fafafa;
        }
        .test-section h2 {
            color: #555;
            margin-top: 0;
        }
        button {
            background-color: #007cba;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        button:hover {
            background-color: #005a87;
        }
        button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        .output {
            background-color: #1e1e1e;
            color: #d4d4d4;
            padding: 15px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 15px;
        }
        .success {
            color: #4caf50;
        }
        .error {
            color: #f44336;
        }
        .info {
            color: #2196f3;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>åŠå…¬æ—å¥åº·æé†’ç³»ç»Ÿ - å•å…ƒæµ‹è¯•</h1>
        
        <div class="test-section">
            <h2>StorageManager æµ‹è¯•</h2>
            <button onclick="runStorageManagerTests()">è¿è¡Œ StorageManager æµ‹è¯•</button>
            <div id="storageOutput" class="output" style="display: none;"></div>
        </div>
        
        <div class="test-section">
            <h2>AppSettings æµ‹è¯•</h2>
            <button onclick="runAppSettingsTests()">è¿è¡Œ AppSettings æµ‹è¯•</button>
            <div id="settingsOutput" class="output" style="display: none;"></div>
        </div>
        
        <div class="test-section">
            <h2>ReminderManager æµ‹è¯•</h2>
            <button onclick="runReminderManagerTests()">è¿è¡Œ ReminderManager æµ‹è¯•</button>
            <div id="reminderOutput" class="output" style="display: none;"></div>
        </div>
        
        <div class="test-section">
            <h2>MobileAdapter æµ‹è¯•</h2>
            <button onclick="runMobileAdapterTests()">è¿è¡Œ MobileAdapter æµ‹è¯•</button>
            <div id="mobileOutput" class="output" style="display: none;"></div>
        </div>
        
        <div class="test-section">
            <h2>åŸºç¡€é›†æˆæµ‹è¯•</h2>
            <button onclick="runIntegrationTests()">è¿è¡ŒåŸºç¡€é›†æˆæµ‹è¯•</button>
            <div id="integrationOutput" class="output" style="display: none;"></div>
        </div>
        
        <div class="test-section">
            <h2>ç”¨æˆ·æµç¨‹é›†æˆæµ‹è¯•</h2>
            <button onclick="runUserFlowTests()">è¿è¡Œç”¨æˆ·æµç¨‹æµ‹è¯•</button>
            <div id="userFlowOutput" class="output" style="display: none;"></div>
        </div>
        
        <div class="test-section">
            <h2>æµè§ˆå™¨å…¼å®¹æ€§æµ‹è¯•</h2>
            <button onclick="runBrowserCompatibilityTests()">è¿è¡Œå…¼å®¹æ€§æµ‹è¯•</button>
            <div id="compatibilityOutput" class="output" style="display: none;"></div>
        </div>
        
        <div class="test-section">
            <h2>å“åº”å¼è®¾è®¡æµ‹è¯•</h2>
            <button onclick="runResponsiveDesignTests()">è¿è¡Œå“åº”å¼è®¾è®¡æµ‹è¯•</button>
            <div id="responsiveOutput" class="output" style="display: none;"></div>
        </div>
        
        <div class="test-section">
            <h2>å…¨éƒ¨æµ‹è¯•</h2>
            <button onclick="runAllTests()">è¿è¡Œæ‰€æœ‰æµ‹è¯•</button>
            <button onclick="clearAllOutputs()">æ¸…é™¤è¾“å‡º</button>
        </div>
    </div>

    <!-- åŠ è½½æºä»£ç  -->
    <script src="../js/storage-manager.js"></script>
    <script src="../js/app-settings.js"></script>
    <script src="../js/reminder-manager.js"></script>
    <script src="../js/notification-service.js"></script>
    <script src="../js/activity-detector.js"></script>
    <script src="../js/error-handler.js"></script>
    <script src="../js/mobile-adapter.js"></script>
    
    <!-- åŠ è½½æµ‹è¯•ä»£ç  -->
    <script src="storage-manager.test.js"></script>
    <script src="app-settings.test.js"></script>
    <script src="reminder-manager.test.js"></script>
    <script src="mobile-adapter.test.js"></script>
    <script src="activity-reminder-integration.test.js"></script>
    <script src="user-flow-integration.test.js"></script>
    <script src="browser-compatibility.test.js"></script>
    <script src="responsive-design.test.js"></script>

    <script>
        // é‡å®šå‘consoleè¾“å‡ºåˆ°é¡µé¢
        function createConsoleRedirector(outputElementId) {
            const outputElement = document.getElementById(outputElementId);
            const originalConsole = {
                log: console.log,
                error: console.error,
                warn: console.warn
            };
            
            return {
                start() {
                    outputElement.style.display = 'block';
                    outputElement.innerHTML = '';
                    
                    console.log = (...args) => {
                        outputElement.innerHTML += '<span class="info">' + args.join(' ') + '</span>\n';
                        outputElement.scrollTop = outputElement.scrollHeight;
                    };
                    
                    console.error = (...args) => {
                        outputElement.innerHTML += '<span class="error">' + args.join(' ') + '</span>\n';
                        outputElement.scrollTop = outputElement.scrollHeight;
                    };
                    
                    console.warn = (...args) => {
                        outputElement.innerHTML += '<span class="error">' + args.join(' ') + '</span>\n';
                        outputElement.scrollTop = outputElement.scrollHeight;
                    };
                },
                
                stop() {
                    console.log = originalConsole.log;
                    console.error = originalConsole.error;
                    console.warn = originalConsole.warn;
                }
            };
        }

        async function runStorageManagerTests() {
            const redirector = createConsoleRedirector('storageOutput');
            
            try {
                redirector.start();
                console.log('=== StorageManager å•å…ƒæµ‹è¯• ===\n');
                
                const tests = new StorageManagerTests();
                const success = tests.runAllTests();
                
                console.log('\n=== æµ‹è¯•å®Œæˆ ===');
                if (success) {
                    console.log('âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼');
                } else {
                    console.log('âŒ éƒ¨åˆ†æµ‹è¯•å¤±è´¥');
                }
                
            } catch (error) {
                console.error('æµ‹è¯•è¿è¡Œå‡ºé”™:', error);
            } finally {
                redirector.stop();
            }
        }

        async function runAppSettingsTests() {
            const redirector = createConsoleRedirector('settingsOutput');
            
            try {
                redirector.start();
                console.log('=== AppSettings å•å…ƒæµ‹è¯• ===\n');
                
                const tests = new AppSettingsTests();
                const success = tests.runAllTests();
                
                console.log('\n=== æµ‹è¯•å®Œæˆ ===');
                if (success) {
                    console.log('âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼');
                } else {
                    console.log('âŒ éƒ¨åˆ†æµ‹è¯•å¤±è´¥');
                }
                
            } catch (error) {
                console.error('æµ‹è¯•è¿è¡Œå‡ºé”™:', error);
            } finally {
                redirector.stop();
            }
        }

        async function runIntegrationTests() {
            const redirector = createConsoleRedirector('integrationOutput');
            
            try {
                redirector.start();
                console.log('=== é›†æˆæµ‹è¯• ===\n');
                
                // æµ‹è¯•StorageManagerå’ŒAppSettingsçš„é›†æˆ
                console.log('æµ‹è¯• StorageManager å’Œ AppSettings é›†æˆ...');
                
                const storageManager = new StorageManager();
                const appSettings = new AppSettings(storageManager);
                
                // æµ‹è¯•åŸºæœ¬é›†æˆ
                console.log('âœ“ æˆåŠŸåˆ›å»º StorageManager å’Œ AppSettings å®ä¾‹');
                
                // æµ‹è¯•è®¾ç½®ä¿å­˜å’ŒåŠ è½½
                const originalSettings = appSettings.getSettings();
                appSettings.updateSettings('water', { interval: 45 });
                
                // åˆ›å»ºæ–°å®ä¾‹éªŒè¯æŒä¹…åŒ–
                const appSettings2 = new AppSettings(storageManager);
                const loadedSettings = appSettings2.getSettings();
                
                if (loadedSettings.water.interval === 45) {
                    console.log('âœ“ è®¾ç½®æŒä¹…åŒ–æµ‹è¯•é€šè¿‡');
                } else {
                    console.error('âœ— è®¾ç½®æŒä¹…åŒ–æµ‹è¯•å¤±è´¥');
                }
                
                // æµ‹è¯•å­˜å‚¨ä¿¡æ¯
                const storageInfo = storageManager.getStorageInfo();
                console.log('âœ“ å­˜å‚¨ä¿¡æ¯è·å–æˆåŠŸ:', JSON.stringify(storageInfo, null, 2));
                
                // æµ‹è¯•å¤‡ä»½æ¢å¤
                const backup = storageManager.backupData();
                if (backup && backup.app_settings) {
                    console.log('âœ“ æ•°æ®å¤‡ä»½æµ‹è¯•é€šè¿‡');
                } else {
                    console.error('âœ— æ•°æ®å¤‡ä»½æµ‹è¯•å¤±è´¥');
                }
                
                // è¿è¡Œæ´»åŠ¨æ£€æµ‹å™¨å’Œæé†’ç®¡ç†å™¨é›†æˆæµ‹è¯•
                console.log('\næµ‹è¯•æ´»åŠ¨æ£€æµ‹å™¨å’Œæé†’ç®¡ç†å™¨é›†æˆ...');
                const activityReminderTests = new ActivityReminderIntegrationTests();
                const activityReminderSuccess = activityReminderTests.runAllTests();
                
                if (activityReminderSuccess) {
                    console.log('âœ“ æ´»åŠ¨æ£€æµ‹å™¨å’Œæé†’ç®¡ç†å™¨é›†æˆæµ‹è¯•é€šè¿‡');
                } else {
                    console.error('âœ— æ´»åŠ¨æ£€æµ‹å™¨å’Œæé†’ç®¡ç†å™¨é›†æˆæµ‹è¯•å¤±è´¥');
                }
                
                console.log('\n=== é›†æˆæµ‹è¯•å®Œæˆ ===');
                console.log('âœ… æ‰€æœ‰é›†æˆæµ‹è¯•é€šè¿‡ï¼');
                
            } catch (error) {
                console.error('é›†æˆæµ‹è¯•å‡ºé”™:', error);
            } finally {
                redirector.stop();
            }
        }

        async function runReminderManagerTests() {
            const redirector = createConsoleRedirector('reminderOutput');
            
            try {
                redirector.start();
                console.log('=== ReminderManager å•å…ƒæµ‹è¯• ===\n');
                
                const tests = new ReminderManagerTests();
                const success = tests.runAllTests();
                
                console.log('\n=== æµ‹è¯•å®Œæˆ ===');
                if (success) {
                    console.log('âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼');
                } else {
                    console.log('âŒ éƒ¨åˆ†æµ‹è¯•å¤±è´¥');
                }
                
            } catch (error) {
                console.error('æµ‹è¯•è¿è¡Œå‡ºé”™:', error);
            } finally {
                redirector.stop();
            }
        }

        async function runMobileAdapterTests() {
            const redirector = createConsoleRedirector('mobileOutput');
            
            try {
                redirector.start();
                console.log('=== MobileAdapter å•å…ƒæµ‹è¯• ===\n');
                
                const tests = new MobileAdapterTests();
                const success = tests.runAllTests();
                
                console.log('\n=== æµ‹è¯•å®Œæˆ ===');
                if (success) {
                    console.log('âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼');
                } else {
                    console.log('âŒ éƒ¨åˆ†æµ‹è¯•å¤±è´¥');
                }
                
            } catch (error) {
                console.error('æµ‹è¯•è¿è¡Œå‡ºé”™:', error);
            } finally {
                redirector.stop();
            }
        }

        async function runAllTests() {
            console.log('å¼€å§‹è¿è¡Œæ‰€æœ‰æµ‹è¯•...\n');
            
            await runStorageManagerTests();
            await new Promise(resolve => setTimeout(resolve, 500)); // çŸ­æš‚å»¶è¿Ÿ
            
            await runAppSettingsTests();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await runReminderManagerTests();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await runMobileAdapterTests();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await runIntegrationTests();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await runUserFlowTests();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await runBrowserCompatibilityTests();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await runResponsiveDesignTests();
            
            console.log('\nğŸ‰ æ‰€æœ‰æµ‹è¯•è¿è¡Œå®Œæˆï¼');
        }

        async function runUserFlowTests() {
            const redirector = createConsoleRedirector('userFlowOutput');
            
            try {
                redirector.start();
                console.log('=== ç”¨æˆ·æµç¨‹é›†æˆæµ‹è¯• ===\n');
                
                const tests = new UserFlowIntegrationTests();
                const success = tests.runAllTests();
                
                console.log('\n=== æµ‹è¯•å®Œæˆ ===');
                if (success) {
                    console.log('âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼');
                } else {
                    console.log('âŒ éƒ¨åˆ†æµ‹è¯•å¤±è´¥');
                }
                
            } catch (error) {
                console.error('æµ‹è¯•è¿è¡Œå‡ºé”™:', error);
            } finally {
                redirector.stop();
            }
        }

        async function runBrowserCompatibilityTests() {
            const redirector = createConsoleRedirector('compatibilityOutput');
            
            try {
                redirector.start();
                console.log('=== æµè§ˆå™¨å…¼å®¹æ€§æµ‹è¯• ===\n');
                
                const tests = new BrowserCompatibilityTests();
                const success = tests.runAllTests();
                
                console.log('\n=== æµ‹è¯•å®Œæˆ ===');
                if (success) {
                    console.log('âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼');
                } else {
                    console.log('âŒ éƒ¨åˆ†æµ‹è¯•å¤±è´¥');
                }
                
            } catch (error) {
                console.error('æµ‹è¯•è¿è¡Œå‡ºé”™:', error);
            } finally {
                redirector.stop();
            }
        }

        async function runResponsiveDesignTests() {
            const redirector = createConsoleRedirector('responsiveOutput');
            
            try {
                redirector.start();
                console.log('=== å“åº”å¼è®¾è®¡æµ‹è¯• ===\n');
                
                const tests = new ResponsiveDesignTests();
                const success = tests.runAllTests();
                
                console.log('\n=== æµ‹è¯•å®Œæˆ ===');
                if (success) {
                    console.log('âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼');
                } else {
                    console.log('âŒ éƒ¨åˆ†æµ‹è¯•å¤±è´¥');
                }
                
            } catch (error) {
                console.error('æµ‹è¯•è¿è¡Œå‡ºé”™:', error);
            } finally {
                redirector.stop();
            }
        }

        function clearAllOutputs() {
            const outputs = [
                'storageOutput', 
                'settingsOutput', 
                'reminderOutput', 
                'mobileOutput', 
                'integrationOutput',
                'userFlowOutput',
                'compatibilityOutput',
                'responsiveOutput'
            ];
            outputs.forEach(id => {
                const element = document.getElementById(id);
                element.innerHTML = '';
                element.style.display = 'none';
            });
        }

        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('æµ‹è¯•é¡µé¢å·²åŠ è½½ï¼Œå¯ä»¥å¼€å§‹è¿è¡Œæµ‹è¯•');
        });
    </script>
</body>
</html>