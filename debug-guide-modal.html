<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Guide Modal</title>
    <link rel="stylesheet" href="styles/main.css">
    <style>
        body {
            padding: 20px;
            font-family: Arial, sans-serif;
        }
        .debug-info {
            background: #f0f0f0;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .test-button {
            background: #3498db;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px;
        }
    </style>
</head>
<body>
    <h1>Debug Guide Modal</h1>
    
    <div class="debug-info">
        <h3>测试信息</h3>
        <p>这个页面用于测试首次使用引导弹窗的问题</p>
    </div>
    
    <button class="test-button" onclick="showTestGuide()">显示测试引导弹窗</button>
    <button class="test-button" onclick="checkElements()">检查DOM元素</button>
    
    <div id="debug-output"></div>

    <script>
        function log(message) {
            const output = document.getElementById('debug-output');
            output.innerHTML += '<div>' + new Date().toLocaleTimeString() + ': ' + message + '</div>';
            console.log(message);
        }

        function showTestGuide() {
            log('开始创建测试引导弹窗...');
            
            try {
                // 创建引导弹窗
                const guideOverlay = document.createElement('div');
                guideOverlay.className = 'guide-overlay';
                guideOverlay.innerHTML = `
                    <div class="guide-modal">
                        <div class="guide-header">
                            <h2>Welcome to Office Wellness Reminder</h2>
                            <button class="btn-close" id="guide-close">×</button>
                        </div>
                        <div class="guide-content">
                            <div class="guide-step">
                                <div class="guide-step-number">1</div>
                                <div class="guide-step-content">
                                    <h3>Set Reminder Intervals</h3>
                                    <p>Set water and standup reminder intervals according to your needs</p>
                                </div>
                            </div>
                            <div class="guide-step">
                                <div class="guide-step-number">2</div>
                                <div class="guide-step-content">
                                    <h3>Enable Reminders</h3>
                                    <p>Click the "Start" button to activate reminders</p>
                                </div>
                            </div>
                            <div class="guide-step">
                                <div class="guide-step-number">3</div>
                                <div class="guide-step-content">
                                    <h3>Confirm Completion</h3>
                                    <p>After receiving a reminder, click the "Done" button to confirm and reset the timer</p>
                                </div>
                            </div>
                        </div>
                        <div class="guide-footer">
                            <button class="btn-primary" id="guide-settings">Configure Settings</button>
                            <button class="btn-secondary" id="guide-start">Start Now</button>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(guideOverlay);
                log('弹窗HTML已添加到DOM');
                
                // 使用setTimeout确保DOM元素已经完全添加
                setTimeout(() => {
                    const closeBtn = document.getElementById('guide-close');
                    const settingsBtn = document.getElementById('guide-settings');
                    const startBtn = document.getElementById('guide-start');
                    
                    log('查找按钮元素: close=' + !!closeBtn + ', settings=' + !!settingsBtn + ', start=' + !!startBtn);
                    
                    if (closeBtn) {
                        closeBtn.addEventListener('click', (event) => {
                            event.preventDefault();
                            event.stopPropagation();
                            log('关闭按钮被点击');
                            closeGuide(guideOverlay);
                        });
                        log('关闭按钮事件监听器已添加');
                    }
                    
                    if (settingsBtn) {
                        settingsBtn.addEventListener('click', (event) => {
                            event.preventDefault();
                            event.stopPropagation();
                            log('设置按钮被点击');
                            closeGuide(guideOverlay);
                        });
                        log('设置按钮事件监听器已添加');
                    }
                    
                    if (startBtn) {
                        startBtn.addEventListener('click', (event) => {
                            event.preventDefault();
                            event.stopPropagation();
                            log('开始按钮被点击');
                            closeGuide(guideOverlay);
                        });
                        log('开始按钮事件监听器已添加');
                    }
                    
                    // 添加点击外部关闭功能
                    guideOverlay.addEventListener('click', (event) => {
                        if (event.target === guideOverlay) {
                            log('点击外部区域关闭弹窗');
                            closeGuide(guideOverlay);
                        }
                    });
                    
                }, 100);
                
            } catch (error) {
                log('创建引导弹窗时出错: ' + error.message);
                console.error('Error:', error);
            }
        }

        function closeGuide(guideOverlay) {
            log('正在关闭引导弹窗...');
            if (guideOverlay && guideOverlay.parentNode) {
                guideOverlay.parentNode.removeChild(guideOverlay);
                log('引导弹窗已从DOM中移除');
            } else {
                log('警告: 引导弹窗未找到或已被移除');
            }
        }

        function checkElements() {
            log('检查页面元素...');
            const overlay = document.querySelector('.guide-overlay');
            const modal = document.querySelector('.guide-modal');
            const closeBtn = document.getElementById('guide-close');
            const settingsBtn = document.getElementById('guide-settings');
            const startBtn = document.getElementById('guide-start');
            
            log('元素检查结果:');
            log('- guide-overlay: ' + !!overlay);
            log('- guide-modal: ' + !!modal);
            log('- guide-close: ' + !!closeBtn);
            log('- guide-settings: ' + !!settingsBtn);
            log('- guide-start: ' + !!startBtn);
            
            if (overlay) {
                log('弹窗样式: ' + overlay.style.cssText);
                log('弹窗类名: ' + overlay.className);
            }
        }
    </script>
</body>
</html>