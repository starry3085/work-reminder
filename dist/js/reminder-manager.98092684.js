class ReminderManager{constructor(t,i,e,s=null){this.type=t,this.settings={...i},this.notificationService=e,this.activityDetector=s,this.isActive=!1,this.isPaused=!1,this.timer=null,this.startTime=null,this.pauseTime=null,this.nextReminderTime=null,this.timeRemaining=0,this.statusChangeCallback=null,this.timeUpdateCallback=null,this.updateInterval=1e3,this.updateTimer=null,"posture"===this.type&&this.activityDetector&&this.setupActivityDetection(),console.log(`${this.type}æé†’ç®¡ç†å™¨å·²åˆ›å»º`)}setupActivityDetection(){if(!this.activityDetector)return;const t=this.activityDetector.callback;this.activityDetector.callback=i=>{t&&t(i),this.handleActivityEvent(i)}}handleActivityEvent(t){if("posture"===this.type)switch(t.type){case"user-away":this.isActive&&!this.isPaused&&this.pause(!0);break;case"user-return":this.isActive&&this.isPaused&&this.resume(!0)}}start(){this.isActive?console.warn(`${this.type}æé†’å·²ç»åœ¨è¿è¡Œä¸­`):(this.isActive=!0,this.isPaused=!1,this.startTime=Date.now(),this.timeRemaining=60*this.settings.interval*1e3,this.nextReminderTime=this.startTime+this.timeRemaining,this.startTimer(),this.startUpdateTimer(),"posture"===this.type&&this.activityDetector&&this.activityDetector.startMonitoring(),this.triggerStatusChange({status:"started",isActive:!0,isPaused:!1,timeRemaining:this.timeRemaining}),console.log(`${this.type}æé†’å·²å¯åŠ¨ï¼Œé—´éš”: ${this.settings.interval}åˆ†é’Ÿ`))}stop(){this.isActive?(this.isActive=!1,this.isPaused=!1,this.clearTimer(),this.clearUpdateTimer(),"posture"===this.type&&this.activityDetector&&this.activityDetector.stopMonitoring(),this.resetState(),this.triggerStatusChange({status:"stopped",isActive:!1,isPaused:!1,timeRemaining:0}),console.log(`${this.type}æé†’å·²åœæ­¢`)):console.warn(`${this.type}æé†’æœªåœ¨è¿è¡Œ`)}pause(t=!1){if(!this.isActive||this.isPaused)return void(t||console.warn(`${this.type}æé†’æœªåœ¨è¿è¡Œæˆ–å·²æš‚åœ`));this.isPaused=!0,this.pauseTime=Date.now();const i=this.pauseTime-this.startTime;this.timeRemaining=Math.max(0,this.timeRemaining-i),this.clearTimer(),this.triggerStatusChange({status:"paused",isActive:!0,isPaused:!0,timeRemaining:this.timeRemaining,isAuto:t}),console.log(`${this.type}æé†’å·²${t?"è‡ªåŠ¨":"æ‰‹åŠ¨"}æš‚åœ`)}resume(t=!1){this.isActive&&this.isPaused?(this.isPaused=!1,this.startTime=Date.now(),this.nextReminderTime=this.startTime+this.timeRemaining,this.startTimer(),this.triggerStatusChange({status:"resumed",isActive:!0,isPaused:!1,timeRemaining:this.timeRemaining,isAuto:t}),console.log(`${this.type}æé†’å·²${t?"è‡ªåŠ¨":"æ‰‹åŠ¨"}æ¢å¤`)):t||console.warn(`${this.type}æé†’æœªæš‚åœ`)}reset(){const t=this.isActive;this.isActive&&(this.clearTimer(),this.clearUpdateTimer()),this.resetState(),t&&this.start(),console.log(`${this.type}æé†’å·²é‡ç½®`)}acknowledge(){this.isActive?(this.settings.lastReminder=Date.now(),this.reset(),this.triggerStatusChange({status:"acknowledged",isActive:!0,isPaused:!1,timeRemaining:this.timeRemaining}),console.log(`${this.type}æé†’å·²ç¡®è®¤`)):console.warn(`${this.type}æé†’æœªåœ¨è¿è¡Œ`)}updateSettings(t){const i=this.settings.interval;if(this.settings={...this.settings,...t},t.interval&&t.interval!==i&&this.isActive){const e=60*t.interval*1e3;if(this.isPaused){const t=1-this.timeRemaining/(60*i*1e3);this.timeRemaining=Math.max(0,e*(1-t))}else{const t=(Date.now()-this.startTime)/(60*i*1e3);this.timeRemaining=Math.max(0,e*(1-t)),this.nextReminderTime=Date.now()+this.timeRemaining,this.clearTimer(),this.startTimer()}}console.log(`${this.type}æé†’è®¾ç½®å·²æ›´æ–°:`,this.settings)}getCurrentStatus(){return{type:this.type,isActive:this.isActive,isPaused:this.isPaused,timeRemaining:this.timeRemaining,nextReminderTime:this.nextReminderTime,settings:{...this.settings},lastUpdate:Date.now()}}setStatusChangeCallback(t){this.statusChangeCallback=t}setTimeUpdateCallback(t){this.timeUpdateCallback=t}startTimer(){this.timer&&clearTimeout(this.timer),this.timer=setTimeout(()=>{this.triggerReminder()},this.timeRemaining)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=null)}startUpdateTimer(){this.updateTimer&&clearInterval(this.updateTimer),this.updateTimer=setInterval(()=>{this.updateTimeRemaining()},this.updateInterval)}clearUpdateTimer(){this.updateTimer&&(clearInterval(this.updateTimer),this.updateTimer=null)}updateTimeRemaining(){if(!this.isActive||this.isPaused)return;const t=Date.now();this.timeRemaining=Math.max(0,this.nextReminderTime-t),this.timeUpdateCallback&&this.timeUpdateCallback({type:this.type,timeRemaining:this.timeRemaining,nextReminderTime:this.nextReminderTime,progress:1-this.timeRemaining/(60*this.settings.interval*1e3)})}triggerReminder(){if(!this.isActive)return;const t="water"===this.type?"ğŸ’§ å–æ°´æ—¶é—´åˆ°äº†ï¼":"ğŸ§˜ è¯¥èµ·èº«æ´»åŠ¨äº†ï¼",i="water"===this.type?"é•¿æ—¶é—´å·¥ä½œå®¹æ˜“è„±æ°´ï¼Œè®°å¾—è¡¥å……æ°´åˆ†å“¦ï¼":"ä¹…åå¯¹èº«ä½“ä¸å¥½ï¼Œèµ·æ¥æ´»åŠ¨ä¸€ä¸‹å§ï¼";this.notificationService.showNotification(this.type,t,i,()=>this.acknowledge(),()=>this.snooze()),this.triggerStatusChange({status:"triggered",isActive:!0,isPaused:!1,timeRemaining:0}),setTimeout(()=>{this.isActive&&0===this.timeRemaining&&this.reset()},6e4),console.log(`${this.type}æé†’å·²è§¦å‘`)}snooze(){this.isActive&&(this.timeRemaining=3e5,this.startTime=Date.now(),this.nextReminderTime=this.startTime+this.timeRemaining,this.clearTimer(),this.startTimer(),this.triggerStatusChange({status:"snoozed",isActive:!0,isPaused:!1,timeRemaining:this.timeRemaining}),console.log(`${this.type}æé†’å·²å»¶è¿Ÿ5åˆ†é’Ÿ`))}resetState(){this.startTime=null,this.pauseTime=null,this.nextReminderTime=null,this.timeRemaining=0}triggerStatusChange(t){this.statusChangeCallback&&this.statusChangeCallback({...t,type:this.type,timestamp:Date.now()})}restoreState(t){if(t)try{return this.isActive=t.isActive||!1,this.isPaused=t.isPaused||!1,t.timeRemaining&&(this.timeRemaining=t.timeRemaining),t.nextReminderAt?this.nextReminderTime=t.nextReminderAt:this.timeRemaining>0&&(this.nextReminderTime=Date.now()+this.timeRemaining),this.isActive&&!this.isPaused?(this.startTime=Date.now(),this.startTimer(),this.startUpdateTimer(),"posture"===this.type&&this.activityDetector&&this.activityDetector.startMonitoring(),this.triggerStatusChange({status:"restored",isActive:!0,isPaused:!1,timeRemaining:this.timeRemaining})):this.isActive&&this.isPaused&&(this.pauseTime=Date.now(),this.triggerStatusChange({status:"restored",isActive:!0,isPaused:!0,timeRemaining:this.timeRemaining})),console.log(`${this.type}æé†’çŠ¶æ€å·²æ¢å¤:`,{isActive:this.isActive,isPaused:this.isPaused,timeRemaining:this.timeRemaining}),!0}catch(t){return console.error(`æ¢å¤${this.type}æé†’çŠ¶æ€å¤±è´¥:`,t),!1}}destroy(){this.stop(),this.statusChangeCallback=null,this.timeUpdateCallback=null,"posture"===this.type&&this.activityDetector&&this.activityDetector.stopMonitoring(),console.log(`${this.type}æé†’ç®¡ç†å™¨å·²é”€æ¯`)}}"undefined"!=typeof module&&module.exports&&(module.exports=ReminderManager);