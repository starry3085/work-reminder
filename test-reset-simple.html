<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>简单RESET按钮测试</title>
    <link rel="stylesheet" href="styles/main.css">
</head>
<body>
    <div class="app-container">
        <h1>简单RESET按钮测试</h1>
        
        <section class="reminders-section">
            <div class="reminder-card" id="water-card">
                <div class="card-header">
                    <div class="card-icon water-icon"></div>
                    <h3>Water Reminder</h3>
                    <div class="status-badge inactive" id="water-status-badge">Inactive</div>
                </div>
                <div class="card-content">
                    <div class="status-info">
                        <span class="next-reminder-label">Remind every:</span>
                        <div class="time-remaining" id="water-time">
                            <input type="number" id="water-interval-display" min="1" max="60" value="1" class="interval-input"> mins
                        </div>
                    </div>
                </div>
                <div class="card-controls">
                    <button class="btn-primary" id="water-toggle">Start</button>
                    <button class="btn-secondary" id="water-reset" style="display: none;">Reset</button>
                    <button class="btn-action" id="waterDrink" style="display: none;">Hydrated</button>
                </div>
            </div>

            <div class="reminder-card" id="standup-card">
                <div class="card-header">
                    <div class="card-icon standup-icon"></div>
                    <h3>Standup Reminder</h3>
                    <div class="status-badge inactive" id="standup-status-badge">Inactive</div>
                </div>
                <div class="card-content">
                    <div class="status-info">
                        <span class="next-reminder-label">Remind every:</span>
                        <div class="time-remaining" id="standup-time">
                            <input type="number" id="standup-interval-display" min="1" max="60" value="1" class="interval-input"> mins
                        </div>
                    </div>
                </div>
                <div class="card-controls">
                    <button class="btn-primary" id="standup-toggle">Start</button>
                    <button class="btn-secondary" id="standup-reset" style="display: none;">Reset</button>
                    <button class="btn-action" id="standupActivity" style="display: none;">Moved</button>
                </div>
            </div>
        </section>
        
        <div id="status-display" style="margin-top: 20px; padding: 10px; background: #f8f9fa; border-radius: 4px;">
            <h3>状态日志:</h3>
            <div id="log-content" style="font-family: monospace; white-space: pre-wrap;"></div>
        </div>
    </div>

    <script>
        // 简单的日志函数
        function log(message) {
            const logContent = document.getElementById('log-content');
            const timestamp = new Date().toLocaleTimeString();
            logContent.textContent += `[${timestamp}] ${message}\n`;
            console.log(message);
        }

        // 简单的提醒状态管理
        class SimpleReminderManager {
            constructor(type) {
                this.type = type;
                this.isActive = false;
                this.timer = null;
                this.timeRemaining = 0;
                this.interval = 1; // 1分钟用于测试
            }

            start() {
                if (this.isActive) return;
                
                this.isActive = true;
                this.timeRemaining = this.interval * 60 * 1000; // 转换为毫秒
                
                log(`${this.type}提醒已启动，间隔: ${this.interval}分钟`);
                
                // 启动计时器
                this.timer = setTimeout(() => {
                    this.trigger();
                }, this.timeRemaining);
                
                this.updateUI();
            }

            stop() {
                if (!this.isActive) return;
                
                this.isActive = false;
                if (this.timer) {
                    clearTimeout(this.timer);
                    this.timer = null;
                }
                
                log(`${this.type}提醒已停止`);
                this.updateUI();
            }

            reset() {
                log(`${this.type}提醒重置被调用`);
                
                if (this.isActive) {
                    // 清除当前计时器
                    if (this.timer) {
                        clearTimeout(this.timer);
                        this.timer = null;
                    }
                    
                    // 重新启动
                    this.timeRemaining = this.interval * 60 * 1000;
                    this.timer = setTimeout(() => {
                        this.trigger();
                    }, this.timeRemaining);
                    
                    log(`${this.type}提醒已重置并重新启动`);
                } else {
                    log(`${this.type}提醒未激活，重置无效果`);
                }
            }

            trigger() {
                log(`${this.type}提醒触发！`);
                alert(`${this.type}提醒时间到了！`);
                
                // 自动重新开始
                this.reset();
            }

            updateUI() {
                const card = document.getElementById(`${this.type}-card`);
                const statusBadge = document.getElementById(`${this.type}-status-badge`);
                const toggleBtn = document.getElementById(`${this.type}-toggle`);
                const resetBtn = document.getElementById(`${this.type}-reset`);
                const actionBtn = document.getElementById(this.type === 'water' ? 'waterDrink' : 'standupActivity');

                if (this.isActive) {
                    card.classList.add('active');
                    statusBadge.textContent = 'Active';
                    statusBadge.classList.add('active');
                    statusBadge.classList.remove('inactive');
                    
                    toggleBtn.textContent = 'Pause';
                    toggleBtn.className = 'btn-secondary';
                    resetBtn.style.display = 'inline-block';
                    actionBtn.style.display = 'inline-block';
                } else {
                    card.classList.remove('active');
                    statusBadge.textContent = 'Inactive';
                    statusBadge.classList.remove('active');
                    statusBadge.classList.add('inactive');
                    
                    toggleBtn.textContent = 'Start';
                    toggleBtn.className = 'btn-primary';
                    resetBtn.style.display = 'none';
                    actionBtn.style.display = 'none';
                }
            }
        }

        // 创建提醒管理器实例
        let waterReminder = null;
        let standupReminder = null;

        // 初始化应用
        document.addEventListener('DOMContentLoaded', function() {
            log('DOM加载完成，开始初始化...');
            
            // 创建提醒管理器
            waterReminder = new SimpleReminderManager('water');
            standupReminder = new SimpleReminderManager('standup');
            
            // 绑定水提醒事件
            const waterToggle = document.getElementById('water-toggle');
            const waterReset = document.getElementById('water-reset');
            const waterDrink = document.getElementById('waterDrink');
            
            if (waterToggle) {
                waterToggle.addEventListener('click', function() {
                    log('水提醒Toggle按钮被点击');
                    if (waterReminder.isActive) {
                        waterReminder.stop();
                    } else {
                        waterReminder.start();
                    }
                });
            }
            
            if (waterReset) {
                waterReset.addEventListener('click', function() {
                    log('水提醒Reset按钮被点击');
                    waterReminder.reset();
                });
            }
            
            if (waterDrink) {
                waterDrink.addEventListener('click', function() {
                    log('水提醒Drink按钮被点击');
                    waterReminder.reset();
                });
            }
            
            // 绑定站立提醒事件
            const standupToggle = document.getElementById('standup-toggle');
            const standupReset = document.getElementById('standup-reset');
            const standupActivity = document.getElementById('standupActivity');
            
            if (standupToggle) {
                standupToggle.addEventListener('click', function() {
                    log('站立提醒Toggle按钮被点击');
                    if (standupReminder.isActive) {
                        standupReminder.stop();
                    } else {
                        standupReminder.start();
                    }
                });
            }
            
            if (standupReset) {
                standupReset.addEventListener('click', function() {
                    log('站立提醒Reset按钮被点击');
                    standupReminder.reset();
                });
            }
            
            if (standupActivity) {
                standupActivity.addEventListener('click', function() {
                    log('站立提醒Activity按钮被点击');
                    standupReminder.reset();
                });
            }
            
            log('事件绑定完成');
            log('请点击Start按钮启动提醒，然后测试Reset按钮');
        });
    </script>
</body>
</html>