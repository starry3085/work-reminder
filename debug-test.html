<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åº”ç”¨è¯Šæ–­æµ‹è¯•</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .status { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .warning { background: #fff3cd; color: #856404; }
        .log { background: #f8f9fa; padding: 10px; margin: 10px 0; border-left: 4px solid #007bff; }
        pre { background: #f8f9fa; padding: 10px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>ğŸ” åº”ç”¨è¯Šæ–­æµ‹è¯•</h1>
    <div id="results"></div>
    
    <script>
        const results = document.getElementById('results');
        
        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `status ${type}`;
            div.innerHTML = message;
            results.appendChild(div);
            console.log(message);
        }
        
        function logDetail(title, data) {
            const div = document.createElement('div');
            div.className = 'log';
            div.innerHTML = `<strong>${title}:</strong><pre>${JSON.stringify(data, null, 2)}</pre>`;
            results.appendChild(div);
        }
        
        // æ£€æŸ¥è„šæœ¬åŠ è½½
        function checkScriptLoading() {
            log('<h3>ğŸ“ æ£€æŸ¥è„šæœ¬æ–‡ä»¶åŠ è½½</h3>');
            
            const scripts = [
                'js/debug-helper.js',
                'js/error-handler.js', 
                'js/storage-manager.js',
                'js/app-settings.js',
                'js/notification-service.js',
                'js/activity-detector.js',
                'js/reminder-manager.js',
                'js/water-reminder.js',
                'js/standup-reminder.js',
                'js/mobile-adapter.js',
                'js/ui-controller.js',
                'js/app.js'
            ];
            
            let loadedCount = 0;
            let totalCount = scripts.length;
            
            scripts.forEach(src => {
                const script = document.createElement('script');
                script.src = src;
                script.onload = () => {
                    loadedCount++;
                    log(`âœ… ${src} åŠ è½½æˆåŠŸ`, 'success');
                    
                    if (loadedCount === totalCount) {
                        setTimeout(checkClasses, 100);
                    }
                };
                script.onerror = () => {
                    log(`âŒ ${src} åŠ è½½å¤±è´¥`, 'error');
                    loadedCount++;
                    
                    if (loadedCount === totalCount) {
                        setTimeout(checkClasses, 100);
                    }
                };
                document.head.appendChild(script);
            });
        }
        
        // æ£€æŸ¥ç±»å®šä¹‰
        function checkClasses() {
            log('<h3>ğŸ—ï¸ æ£€æŸ¥ç±»å®šä¹‰</h3>');
            
            const requiredClasses = [
                'DebugHelper',
                'ErrorHandler',
                'StorageManager', 
                'AppSettings',
                'NotificationService',
                'ActivityDetector',
                'ReminderManager',
                'WaterReminder',
                'PostureReminder',
                'UIController',
                'MobileAdapter',
                'OfficeWellnessApp'
            ];
            
            const classStatus = {};
            let allClassesAvailable = true;
            
            requiredClasses.forEach(className => {
                const isAvailable = typeof window[className] !== 'undefined';
                classStatus[className] = isAvailable;
                
                if (isAvailable) {
                    log(`âœ… ${className} ç±»å¯ç”¨`, 'success');
                } else {
                    log(`âŒ ${className} ç±»ç¼ºå¤±`, 'error');
                    allClassesAvailable = false;
                }
            });
            
            logDetail('ç±»å¯ç”¨æ€§çŠ¶æ€', classStatus);
            
            if (allClassesAvailable) {
                setTimeout(runDiagnostics, 100);
            } else {
                log('âŒ éƒ¨åˆ†å¿…è¦ç±»ç¼ºå¤±ï¼Œæ— æ³•ç»§ç»­æµ‹è¯•', 'error');
            }
        }
        
        // è¿è¡Œè¯Šæ–­
        async function runDiagnostics() {
            log('<h3>ğŸ” è¿è¡Œç³»ç»Ÿè¯Šæ–­</h3>');
            
            try {
                if (typeof DebugHelper !== 'undefined') {
                    const debugHelper = new DebugHelper();
                    const diagnostics = await debugHelper.runDiagnostics();
                    
                    logDetail('è¯Šæ–­ç»“æœ', diagnostics);
                    
                    if (diagnostics.overall.status === 'success') {
                        log('âœ… ç³»ç»Ÿè¯Šæ–­é€šè¿‡', 'success');
                        setTimeout(testAppCreation, 100);
                    } else {
                        log(`âš ï¸ ç³»ç»Ÿè¯Šæ–­å‘ç°é—®é¢˜: ${diagnostics.overall.status}`, 'warning');
                        setTimeout(testAppCreation, 100);
                    }
                } else {
                    log('âŒ DebugHelper ä¸å¯ç”¨ï¼Œè·³è¿‡è¯Šæ–­', 'error');
                    setTimeout(testAppCreation, 100);
                }
            } catch (error) {
                log(`âŒ è¯Šæ–­è¿è¡Œå¤±è´¥: ${error.message}`, 'error');
                console.error('è¯Šæ–­é”™è¯¯:', error);
                setTimeout(testAppCreation, 100);
            }
        }
        
        // æµ‹è¯•åº”ç”¨åˆ›å»º
        async function testAppCreation() {
            log('<h3>ğŸš€ æµ‹è¯•åº”ç”¨åˆ›å»ºå’Œåˆå§‹åŒ–</h3>');
            
            try {
                // åˆ›å»ºåº”ç”¨å®ä¾‹
                log('åˆ›å»º OfficeWellnessApp å®ä¾‹...');
                const app = new OfficeWellnessApp();
                log('âœ… åº”ç”¨å®ä¾‹åˆ›å»ºæˆåŠŸ', 'success');
                
                // å°è¯•åˆå§‹åŒ–
                log('åˆå§‹åŒ–åº”ç”¨...');
                await app.initialize();
                log('âœ… åº”ç”¨åˆå§‹åŒ–æˆåŠŸï¼', 'success');
                
                // è·å–åº”ç”¨çŠ¶æ€
                const status = app.getCurrentStatus ? app.getCurrentStatus() : 'çŠ¶æ€æ–¹æ³•ä¸å¯ç”¨';
                logDetail('åº”ç”¨çŠ¶æ€', status);
                
                log('<h2>ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼åº”ç”¨è¿è¡Œæ­£å¸¸</h2>', 'success');
                
            } catch (error) {
                log(`âŒ åº”ç”¨æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                console.error('åº”ç”¨é”™è¯¯è¯¦æƒ…:', error);
                
                // æ˜¾ç¤ºé”™è¯¯å †æ ˆ
                if (error.stack) {
                    logDetail('é”™è¯¯å †æ ˆ', error.stack);
                }
            }
        }
        
        // å¼€å§‹æµ‹è¯•
        log('ğŸ”„ å¼€å§‹åŠ è½½å’Œæµ‹è¯•åº”ç”¨ç»„ä»¶...');
        checkScriptLoading();
    </script>
</body>
</html>